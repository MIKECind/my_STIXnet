To configure health-monitoring diagnostic testing, use the diagnostic monitor command in global configuration mode. To disable testing, use the no form of this command. diagnostic monitor intervalmodule number test {test-id | test-id-range | all} hh:mm:ss milliseconds days diagnostic monitor syslog diagnostic monitor module num test {test-id | test-id-range | all} no diagnostic monitor {interval | syslog} Cisco UBR10012 Router diagnostic monitor {bay slot/ bay | slot slot number | subslot slot/ subslot} test {test-id | test-id-range | all} diagnostic monitor interval {bay slot/ bay | slot slot-no | subslot slot/ subslot} test {test-id | test-id-range | all} hh:mm:ss milliseconds days diagnostic monitor syslog diagnostic monitor threshold {bay slot/ bay | slot slot-no | subslot slot/ subslot} test {test-id | test-id-range | all} failure count failures [ {runs | days | hours | minutes | seconds | milliseconds} window_size] Syntax Description | interval | Sets the interval between testing. | module number | Specifies the module number. | test | Specifies a test to run. | test-id | Identification number for the test to run. See the ¡°Usage Guidelines¡± section for additional information. | test-id-range | Range of identification numbers for tests to be run. See the ¡°Usage Guidelines¡± section for additional information. | all | Runs all the diagnostic tests. | hour hh | (Optional) Specifies the number of hours between tests. See the ¡°Usage Guidelines¡± section for formatting guidelines. | min mm | (Optional) Specifies the number of minutes between tests. See the ¡°Usage Guidelines¡± section for formatting guidelines. | second ss | (Optional) Specifies the number of seconds between tests. See the ¡°Usage Guidelines¡± section for formatting guidelines. | millisec ms | (Optional) Specifies the number of milliseconds between tests; see the ¡°Usage Guidelines¡± section for formatting guidelines. | syslog | Enables system logging messages when a health-monitoring test fails. | bay slot/bay | Indicates the card slot and bay number where the diagnostic test is run periodically and monitored. The bay keyword is used to refer a SPA on the router. The valid range for the slot number is from 1 to 8 and 0 to 3 for the bay number. | slot slotnumber | Indicates the slot number of the full-height line card where the diagnostic test is run periodically and monitored. The slot keyword is used to refer a full-height line card on the router. The valid range for the slot is from 1 to 8. | subslot slot/subslot | Indicates the slot and subslot number of half-height line card on which the diagnostic test is run periodically and monitored. The subslot keyword is used to refer a half-height line card on the router. The valid range for the slot number is from 1 to 8 and 0 to 1 for the subslot number. | threshold | Configures the failure threshold value for the specified bay, slot, or subslot. | failure count failures | Configures the count for maximum failures allowed after which the failed test results are displayed in the output of the show diagnostic results command. The range for number of allowed failures is 0 to 99. | hh:mm:ss | Hours, minutes, and seconds interval configured to run the test again. | milliseconds | Number of milliseconds between tests. | days | Number of days between tests. The valid range is from 0 to 20. | runs window_size | Number of test-run count for the failure window-size. | days window_size | Number of days for the failure window-size. | hours window_size | Number of hours for the failure window-size. | minutes window_size | Number of minutes for the failure window-size. | seconds window_size | Number of seconds for the failure window-size. | milliseconds window_size | Number of milliseconds for the failure window-size. Command Default The defaults are as follows: - Depending on the test run, monitoring may be enabled or disabled. - Depending on the test run, the default monitoring interval varies. - syslog is enabled. Command Modes Global configuration (config) Command History | Release | Modification | 12.2(14)SX | Support for this command was introduced on the Supervisor Engine 720. | 12.2(17d)SXB | Support for this command on the Supervisor Engine 2 was extended to Release 12.2(17d)SXB. | 12.2(33)SRA | This command was integrated into Cisco IOS Release 12.2(33)SRA. | 12.2(33)SCC | The command was integrated into Cisco IOS Release 12.2(33)SCC to support Generic Online Diagnostics (GOLD) functionality for Cisco UBR10012 Universal Broadband Router. The keywords bay , slot , and subslot were added for the Cisco UBR10012 Universal Broadband Router. Usage Guidelines Use these guidelines when scheduling testing: - test-id -- Enter the show diagnostic content command to display the test ID list . - test-id-range -- Enter the show diagnostic content command to display the test ID list . Enter the range as integers separated by a comma and a hyphen (for example, 1,3-6 specifies test IDs 1, 3, 4, 5, and 6). - hh-- Enter the hours from 1 to 24. - mm-- Enter the minutes from 1 to 60. - days-- Enter the number of days between tests. - ss-- Enter the seconds from 1 to 60. - ms-- Enter the milliseconds from 1 to 1000. Enter the [no ] diagnostic monitor test {test-id | test-id-range | all } command to enable or disable the specified health monitoring test. When entering the diagnostic monitor module number test {test-id | test-id-range | all } command, observe the following: - Required - Isolate network traffic by disabling all connected ports and do not pump test packets during the test. - Remove all modules for testing FIB TCAM and SSRAM memory on the PFC of the supervisor engine. - Reset the system or the test module before putting the system back into the normal operating mode. - Recommended - If the DFC module is present, remove all modules, and then reboot the system before starting the memory test on the central PFC3B of the supervisor engine. - Turn off all background health-monitoring tests on the supervisor engine and the modules using the no diagnostic monitor module number test {test-id | test-id-range | all } command. The FIB TCAM test for central PFC3BXL or PFC3B (on the supervisor engine) takes approximately 4 hours and 30 minutes. The FIB TCAM test for the distributed PFC3BXL or PFC3B (on the DFC module) takes approximately 16 hours. You can run the FIB TCAM test on multiple DFC3BX modules simultaneously. Cisco UBR10012 Router The command syntax to refer a line card or SPAs is different on Cisco UBR10012 Router. The keyword is slot x for a full-height line card, slot x/y for a half-height card, and bay x/y for a SPA. To monitor a diagnostic test periodically, you first need to configure the hours, minutes, and seconds interval to run the diagnostic test using the diagnostic monitor interval command. An error message is displayed, if the interval is not configured before enabling the monitoring. To store log details for failed tests, execute the diagnostic monitor syslog command. A threshold value to specify the maximum count for allowed failures is configured using the diagnostic monitor threshold command. The failed test results can be viewed using the show diagnostic results command, after the number of failed test reaches the maximum number of allowed failures configured using the diagnostic monitor threshold command. Examples The following example shows how to run the specified test every 3 days: Router(config)# diagnostic monitor interval module 5 test 7 09:07:05 45 3 The following example shows how to enable the generation of a syslog message when any health-monitoring test fails: Router(config)# diagnostic monitor syslog Examples The following example shows a sample output of an error message displayed when monitoring is enabled before configuring the test interval: Router(config)# diagnostic monitor bay 1/0 test 2 Aug 12 18:04:56.280: %DIAG-3-MONITOR_INTERVAL_ZERO: Bay 1/0: Monitoring interval is 0. Cannot enable monitoring for Test #2 The following example shows how to configure the periodic interval for running diagnostic tests on the the router before enabling monitoring: Router(config)# diagnostic monitor interval bay 1/0 test 2 06:00:00 100 10 The following example shows how to enable the diagnostic monitoring on bay 1/0: Router(config)# diangostic monitor bay 1/0 test 2 The following example shows how to enable logging of failed messages to syslog: Router(config)# diangostic monitor syslog The following example shows how to configure the failure threshold value after which the failed test results are displayed in the command output for show diagnostic results : Router(config)# diagnostic monitor threshold bay 1/0 test 2 failure count 10